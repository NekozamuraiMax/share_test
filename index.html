<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>サンプル 相談フォーム</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    <link rel="stylesheet" href="js/share_style.css">
</head>
<body>

<form class="w-75 mx-auto" id="shareform">
<label class="mt-3"><big><big>ご相談フォーム</big></big></label>
<p class="mt-3"><big>相談したいこと</big></p>
<div>
<select class="form-control w-100 mt-1" id="genre">
	<option disabled selected>選択して下さい</option>
	<option value="day">放課後デイサービスへのご相談・ご意見</option>
	<option value="service">他のサービスに関するご相談</option>
	<option value="care">子育てについてのご相談</option>
	<option value="else">その他</option>
</select>
</div>
<p class="mt-3"><big>相談の内容(自由記載)</big></p>
<textarea id="textarea" maxlength="400" rows="8" cols="40" placeholder="400字以内で、ご記入ください。"></textarea>
<p id="count">あと<span id="num"></span>文字</p>
<input type="submit" id="submit" class="mt-4 btn btn-primary" value="送信" disabled>	<input type="button" id="cancel" class="mt-4 btn" value="キャンセル" >
</form>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<script>
const shareForm = document.getElementById('shareform');
shareForm.onchange = () => {
	if(document.getElementById('genre').selectedIndex !== 0 && document.getElementById('textarea').value !== ""){
		submit.disabled = false;
	}else submit.disabled = true;
};

const maxChar = 400;
textarea.onkeyup = () => {
	let count = textarea.value.length;
	let limit = maxChar - count;
	$('#num').text(limit);
};

document.getElementById('submit').addEventListener('click', () => {
	if(window.confirm('この内容で送信しますか？')){
		return true;
	}else event.preventDefault();
}, false);

document.getElementById('cancel').addEventListener('click', () => {
	if(window.confirm('中止しますか？')){
		liff.closeWindow();
	}else evenet.preventDefault();
});
	
const id = "1657662321-GMLZ3Qpv";
window.alert('debug start.');

	window.onload = function(e){
	liff.init({
		liffId: id
	}).then(() =>{
		initializeApp();
	}).catch((err) => {
		window.alert(err);
		console.log('LIFF Initialization failed ', err);
	});
};

function initializeApp() {
    // ログインチェック
    if (liff.isLoggedIn()) {
        //ログイン済

    } else {
        // 未ログイン
        let result = window.confirm("LINE Loginしますか？");
        if(result) {
            liff.login();
        }
    }
}

function sendText(text){
	if(!liff.isInClient()){
		window.alert('This button is unavailable as LIFF is currently being opened in an external browser.');
	}else{
		liff.sendMessages([
			{
			type: 'text',
			text: text
			}
		]).then(function(){
			liff.closeWindow();
		}).catch(function(error){
			window.alert('Failed to send message ' + error);
		});
	}
}

const params = (new URL(document.location)).searchParams;
const key = params.get('key');

$(function(){	
	$('form').submit(function(){
		/*
		const genre = document.getElementById("genre").value;
		const date  = document.getElementById("datepicker").value;
		const time  = document.getElementById("scheduled-time").value;
		const freetxt= document.getElementById("textarea").value;
		let message="None. This is not message.";
		
		if(genre==='reserve'){
			message = '[申請内容]予定の追加\n'+'[指定日]'+date+'\n'+'[時間]'+time+'\n'+'[伝達事項]\n'+freetxt+ '\n\n上記の内容で申請しました。';
		}else if(genre==='cancel'){
			message = '[申請内容]キャンセル\n'+'[指定日]'+date+'\n'+'[伝達事項]\n'+freetxt+ '\n\n上記の内容で申請しました。';
		}else if(genre==='change'){
			message = '[申請内容]利用時間の変更\n'+'[指定日]'+date+'\n'+'[時間]'+time+'\n'+'[伝達事項]\n'+freetxt+ '\n\n上記の内容で申請しました。';
		}*/
		sendText('test success.');
		return false;
	});
});
window.alert('debug end.');
</script>

</body>
</html>
